<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>مساعد صوتي</title>
  <style>
    body { font-family: Arial; padding: 20px; text-align: center; }
    button { font-size: 18px; padding: 10px 20px; margin-top: 20px; }
    #response { margin-top: 20px; font-size: 20px; color: #333; }
  </style>
</head>
<body>
  <h1>تحدث مع المساعد الذكي 🎤</h1>
  <button onclick="startListening()">🎙️ اضغط وتحدث</button>
  <div id="response"></div>
  <audio id="audio" controls style="display:none;"></audio>

  <script>
    const responseDiv = document.getElementById("response");
    const audioElement = document.getElementById("audio");

    function startListening() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = "ar-SA";
      recognition.start();

      recognition.onresult = function (event) {
        const transcript = event.results[0][0].transcript;
        responseDiv.innerHTML = "🗣️ قلت: " + transcript;
        sendMessage(transcript);
      };

      recognition.onerror = function (event) {
        responseDiv.innerHTML = "❌ حدث خطأ: " + event.error;
      };
    }

    function sendMessage(message) {
      fetch("https://chatbot-server-nswo.onrender.com/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: message })
      })
      .then(res => res.json())
      .then(data => {
        if (data.reply) {
          responseDiv.innerHTML += "<br>🤖 البوت: " + data.reply;
        }
        if (data.audio_url) {
          audioElement.src = "https://chatbot-server-nswo.onrender.com" + data.audio_url;
          audioElement.style.display = "block";
          audioElement.play();
        }
      })
      .catch(err => {
        responseDiv.innerHTML = "❌ فشل الاتصال بالخادم";
        console.error(err);
      });
    }
  </script>
</body>
</html>
